<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.project.post.mapper.PostXMLMapper">
	<select id="getCount" resultType="_integer">
		SELECT count(*) FROM post WHERE board_class = #{board_class}
	</select>
	
	<select id="getSupportPostList" resultType="com.spring.project.post.dto.PostVO">
		SELECT 
			post.rownumber, post.post_id,  member.member_id, post.comment_id, post.title, post.contents,to_char(post.reg_date, 'yyyy. MM. dd.'), 
			to_char(post.edit_date, 'yyyy. MM. dd.'), post.board_class, post.contents_category, post.process 
		FROM 
			(SELECT rownum as rownumber, post_id, member_id, comment_id, title, contents, reg_date, 
			edit_date, board_class, contents_category, process FROM post) post, member
		WHERE
			post.member_id = member.member_num_id 
		AND
			post.board_class = #{board_class}
		<if test="category eq 6 or category eq 7">
		AND
			post.contents_category = #{category}
		</if>
		ORDER BY post.rownumber DESC
		<!-- Paging -->
		AND
			post.rownumber BETWEEN 
	</select>
	
	<select id="getSupportSearch" resultType="com.spring.project.post.dto.PostVO" parameterType="com.spring.project.post.dto.SearchVO">
		SELECT 
			post.rownumber, post.post_id,  member.member_id, post.comment_id, post.title, post.contents,to_char(post.reg_date, 'yyyy. MM. dd.'), 
			to_char(post.edit_date, 'yyyy. MM. dd.'), post.board_class, post.contents_category, post.process 
		FROM 
			(SELECT rownum as rownumber, post_id, member_id, comment_id, title, contents, reg_date, 
			edit_date, board_class, contents_category, process FROM post) post, member
		WHERE
			post.member_id = member.member_num_id 
		AND
			post.board_class = #{board_class}
		<if test="category eq 6 or category eq 7">
		AND
			post.contents_category = #{category}
		</if>
		<choose>
		<when test="'all'.equals(searchByWhat)">
		AND
			(contents LIKE '%'||#{searchKeyword}||'%' OR title LIKE '%'||#{searchKeyword}||'%')
		</when>
		<when test="'contents'.equals(searchByWhat) or 'title'.equals(searchByWhat)">
		AND
			${searchByWhat} LIKE '%'||#{searchKeyword}||'%'
		</when>
		</choose>
		ORDER BY post.rownumber DESC
	</select>
	
	<select id="getAllSupportPost" resultType="com.spring.project.post.dto.PostVO">
		SELECT 
			post.rownumber, post.post_id,  member.member_id, post.comment_id, post.title, post.contents,to_char(post.reg_date, 'yyyy. MM. dd.'), 
			to_char(post.edit_date, 'yyyy. MM. dd.'), post.board_class, post.contents_category, post.process 
		FROM 
			(SELECT rownum as rownumber, post_id, member_id, comment_id, title, contents, reg_date, 
			edit_date, board_class, contents_category, process FROM post) post, member
		WHERE 
			post.member_id = member.member_num_id 
		AND 
			post.board_class = #{board_class}
		AND
			post.rownumber BETWEEN #{page} AND #{plusPage}
	</select>
	
	<select id="getAllSupportSearchResult" resultType="com.spring.project.post.dto.PostVO">
		SELECT 
			post_id,  member.member_id, comment_id, title, contents, to_char(reg_date, 'yyyy. MM. dd.'), to_char(edit_date, 'yyyy. MM. dd.'), board_class, contents_category, process 
		FROM 
			post, member 
		WHERE 
			post.member_id = member.member_num_id 
		AND 
			board_class = #{board_class}
		AND
			(content LIKE '%'||#{searchKeyword}||'%' OR title LIKE '%'||#{searchKeyword}||'%')
	</select>
	
	<select id="getSpecificSupportSearchResult" resultType="com.spring.project.post.dto.PostVO">
		SELECT 
			post_id, member.member_id, comment_id, title, contents, to_char(reg_date, 'yyyy. MM. dd.'), to_char(edit_date, 'yyyy. MM. dd.'), board_class, contents_category, process 
		FROM 
			post, member 
		WHERE 
			post.member_id = member.member_num_id 
		AND 
			board_class = #{board_class}
		AND
			${searchByWhat} LIKE '%'||#{searchKeyword}||'%'
	</select>
	
	<select id="getAllSupportPostWithCategory" resultType="com.spring.project.post.dto.PostVO">
		SELECT 
			post_id, member.member_id, comment_id, title, contents, to_char(reg_date, 'yyyy. MM. dd.'), to_char(edit_date, 'yyyy. MM. dd.'), board_class, contents_category, process 
		FROM 
			post, member 
		WHERE 
			post.member_id = member.member_num_id 
		AND 
			board_class = #{board_class}
		AND 
			contents_category = #{categoryName}
	</select>
	
	<select id="getSpecificSupportSearchResultWhitCategory" resultType="com.spring.project.post.dto.PostVO">
		SELECT 
			post_id, member.member_id, comment_id, title, contents, to_char(reg_date, 'yyyy. MM. dd.'), to_char(edit_date, 'yyyy. MM. dd.'), board_class, contents_category, process 
		FROM 
			post, member 
		WHERE 
			post.member_id = member.member_num_id 
		AND 
			board_class = #{board_class}
		AND 
			contents_category = #{categoryName}
		AND
			${searchByWhat} LIKE '%'||#{searchKeyword}||'%'
	</select>
	
	
</mapper>